# Quercus Compendium - Web Application

A modern, responsive web application for browsing and exploring oak (Quercus) species data. Built as a Progressive Web App (PWA) with offline support.

## Tech Stack

- **Framework**: SvelteKit with Svelte 5 (runes syntax)
- **Build Tool**: Vite 6
- **Static Adapter**: @sveltejs/adapter-static for GitHub Pages deployment
- **Styling**: Tailwind CSS 4 + Custom CSS Variables
- **PWA**: @vite-pwa/sveltekit with Workbox
- **Data Source**: Static JSON (`static/quercus_data.json`, committed to repo)

## Project Structure

```
web/
├── src/
│   ├── app.html             # HTML template
│   ├── app.css              # Global styles & CSS custom properties
│   ├── routes/              # SvelteKit file-based routing
│   │   ├── +layout.svelte   # Root layout with Header and data loading
│   │   ├── +layout.js       # Prerender configuration
│   │   ├── +page.svelte     # Home page (LandingPage)
│   │   ├── list/+page.svelte           # Species list view
│   │   ├── about/+page.svelte          # About page
│   │   ├── taxonomy/+page.svelte       # Taxonomy browser (genus-level view)
│   │   ├── taxonomy/[...path]/         # Dynamic taxon view
│   │   └── species/[name]/             # Dynamic species detail
│   └── lib/
│       ├── components/      # Svelte components
│       │   ├── Header.svelte
│       │   ├── Search.svelte
│       │   ├── LandingPage.svelte
│       │   ├── SearchResults.svelte
│       │   ├── SpeciesDetail.svelte
│       │   ├── TaxonView.svelte
│       │   ├── AboutPage.svelte
│       │   └── UpdatePrompt.svelte
│       ├── stores/
│       │   └── dataStore.js  # Svelte stores for state management
│       └── db.js             # IndexedDB wrapper (Dexie.js)
├── static/                   # Static assets (icons, data file)
├── svelte.config.js          # SvelteKit config with static adapter
├── vite.config.js            # Vite config + PWA settings
└── package.json              # Dependencies
```

## Architecture & Patterns

### State Management (dataStore.js)

Uses Svelte stores for reactive state:

- **Writable Stores**:
  - `allSpecies`: All loaded species data
  - `isLoading`: Loading state flag
  - `error`: Error state
  - `searchQuery`: Current search text
  - `selectedSpecies`: Currently selected species for detail view

- **Derived Stores**:
  - `filteredSpecies`: Species filtered by search query (searches name, author, synonyms, local_names, range)
  - `speciesCounts`: Calculates species count, hybrid count, and total from filtered results

### Routing & Navigation

- **SvelteKit file-based routing** with path URLs (no hash routing)
- Routes:
  - `/` - Home (LandingPage)
  - `/list/` - Species list view
  - `/about/` - About page
  - `/taxonomy/` - Taxonomy tree view
  - `/taxonomy/[...path]/` - Dynamic taxon view (e.g., `/taxonomy/Quercus/Quercus/`)
  - `/species/[name]/` - Species detail (e.g., `/species/alba/`)
- Base path: `/` (custom domain: oakcompendium.org)
- Navigation: Standard `<a href>` links with `$app/paths` base import
- Browser back/forward buttons work correctly

### Data Flow

1. App loads → `loadSpeciesData()` fetches `/quercus_data.json`
2. Data stored in `allSpecies` store
3. Search input updates `searchQuery` store
4. `filteredSpecies` automatically recomputes via derived store
5. Components reactively update via Svelte subscriptions (`$filteredSpecies`)

### PWA Features

- **Service Worker**: Auto-generated by @vite-pwa/sveltekit
- **Update Strategy**: Prompt user when new version available (via UpdatePrompt component)
- **Caching**:
  - All app assets cached
  - Google Fonts cached (1 year)
  - `quercus_data.json` included in precache
- **Manifest**: Installable as standalone app

## Styling System

### CSS Custom Properties (app.css)

All colors, shadows, and typography defined as CSS variables:

```css
--color-forest-{50-900}  /* Green palette */
--color-oak-brown        /* Accent colors */
--color-background       /* Semantic colors */
--shadow-{sm,md,lg,xl}   /* Elevation system */
--font-serif             /* Typography */
```

### Styling Approach

- **Global styles**: `app.css` (Tailwind import + custom properties)
- **Component styles**: Scoped `<style>` blocks in `.svelte` files
- **Hybrid approach**: Tailwind utilities for layout, custom properties for colors
- **Consistency**: All components reference CSS variables for colors/shadows

### Color Palette

- **Primary**: Forest green (`--color-forest-*`) - used for headers, accents
- **Neutrals**: Stone tones for text and backgrounds
- **Theme**: Nature-inspired with rich greens and earth tones

## Key Components

### +layout.svelte (Root Layout)

- Contains Header component
- Handles initial data loading via `onMount`
- Shows loading and error states
- Wraps all page content with consistent styling

### Header.svelte

- Navigation links using `<a href>` with base path
- Search component integration
- Consistent across all pages

### SearchResults.svelte

- Displays search results for species and sources
- Shows count bar at top: "X species | Y hybrids | Z total"
- When searching, groups results by type (Sources first, then Species)
- Each species shows: name (with × for hybrids), author, common names
- Empty state when no results

### SpeciesDetail.svelte

- Comprehensive species information display
- Shows all available fields (taxonomy, morphology, distribution, etc.)
- For hybrids: shows parent formula and links to parents
- Navigation between related species

### Search.svelte

- Real-time search with clear button
- Searches across: name, author, synonyms, local_names, range
- Shows result count below input
- Styled with glassmorphism effect in header

### UpdatePrompt.svelte

- Appears when new PWA version available
- User can reload to update or dismiss

## Development Workflow

### Running Locally

```bash
npm install
npm run dev        # Dev server at http://localhost:5173
```

### Building

```bash
npm run build      # Outputs to dist/
npm run preview    # Preview production build
```

### Data Updates

The data file `public/quercus_data.json` is committed to the repo. The CLI exports directly to this location. If data structure changes, no code changes needed unless new fields should be displayed. GitHub Actions auto-deploys on push to main.

## Important Conventions

### File Naming

- Components: PascalCase (e.g., `SearchResults.svelte`)
- Utilities: camelCase (e.g., `dataStore.js`)
- Styles: kebab-case for CSS classes

### Code Style

- **Indentation**: 2 spaces
- **Imports**: Group by type (Svelte imports, then local components/stores)
- **Props**: Use `export let propName` in components
- **Events**: Custom events passed as function props (e.g., `onSelectSpecies`)

### Component Communication

- **Parent → Child**: Props
- **Navigation**: Standard `<a href>` links (no callback props for navigation)
- **Global State**: Svelte stores (imported from `$lib/stores/dataStore.js`)

### Accessibility

- Semantic HTML (buttons, proper headings)
- Focus states on interactive elements
- ARIA labels where needed (e.g., clear button)

## Data Structure

Species object shape:
```javascript
{
  name: "alba",           // Species name (without "Quercus")
  is_hybrid: false,
  author: "L. 1753",
  synonyms: [{name: "...", author: "..."}],
  local_names: ["white oak"],
  range: "Eastern North America; 0 to 1600 m",
  growth_habit: "...",
  leaves: "...",
  flowers: "...",
  fruits: "...",
  bark_twigs_buds: "...",
  hardiness_habitat: "...",
  taxonomy: {
    subgenus: "Quercus",
    section: "Quercus",
    subsection: null,
    complex: null
  },
  conservation_status: "...",
  subspecies_varieties: [{...}],
  hybrids: ["Quercus × bebbiana"],  // List of hybrid names
  url: "https://...",

  // Hybrid-specific fields:
  parent_formula: "alba x macrocarpa",
  parent1: "Quercus alba",
  parent2: "Quercus macrocarpa"
}
```

## Common Tasks

### Adding a New Component

1. Create `.svelte` file in `src/lib/components/`
2. Import stores from `$lib/stores/dataStore.js` as needed
3. Use CSS variables for styling consistency
4. For navigation, use `<a href>` with `import { base } from '$app/paths'`
5. Import and use in parent component or route page

### Modifying Search Behavior

Edit the `filteredSpecies` derived store in `dataStore.js:19-48`

### Changing Theme Colors

Modify CSS variables in `app.css:4-38`

### Adding New Data Fields

1. Data comes from scrapers - update scraper if needed
2. Display in `SpeciesDetail.svelte`
3. Optionally add to search in `dataStore.js` filteredSpecies

### PWA Configuration

Edit `vite.config.js:27-69` for:
- Manifest properties (name, theme color, icons)
- Caching strategies
- Service worker options

## Performance Considerations

- **Data Loading**: Single JSON fetch on app load (all species ~2-3MB)
- **Search**: Client-side filtering (fast enough for ~500 species)
- **Caching**: Service worker caches everything for offline use
- **Images**: SVG icons only (no species photos currently)
- **Lazy Loading**: Not needed - single page app with minimal bundle

## Browser Support

- Modern browsers with ES6+ support
- Service Workers required for PWA features
- CSS custom properties required

## Deployment

Static site - can be deployed to:
- GitHub Pages
- Netlify
- Vercel
- Any static hosting

Build output in `dist/` is fully self-contained.

## Future Enhancements

See main README.md for planned features. Web-specific ideas:
- Image gallery integration
- Geographic filtering with map view
- Taxonomy tree visualization
- Advanced search filters (by section, range, etc.)
- Dark mode toggle
- Print-friendly species pages
